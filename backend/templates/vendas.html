<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Controle de Vendas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <h2>Histórico de Vendas</h2>
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="product_id" class="form-label">Produto</label>
            <select name="product_id" id="product_id" class="form-select">
                <option value="">Todos</option>
                {% for product in products %}
                <option value="{{ product.id }}" {% if request.args.get('product_id') == product.id|string %}selected{% endif %}>{{ product.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="start_date" class="form-label">Data Inicial</label>
            <input type="date" name="start_date" id="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
        </div>
        <div class="col-md-3">
            <label for="end_date" class="form-label">Data Final</label>
            <input type="date" name="end_date" id="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
        </div>
        <div class="col-md-2 align-self-end">
            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
        </div>
    </form>
    <table class="table table-bordered">
        <thead>
    <tr>
        <th>Data/Hora</th>
        <th>Produto</th>
        <th>Cor1</th>
        <th>Tamanho</th>
        <th>Quantidade</th>
        <th>Valor Total</th>
        <th>Usuário</th>
        <th>Ações</th>
    </tr>
        </thead>
        <tbody>
            {% for venda in vendas %}
            <tr>
                <td>{{ venda.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ venda.product.nome }}</td>
                <td>{{ venda.product.tamanho }}</td>
                <td>{{ venda.product.cor }}</td>
                <td>{{ venda.quantidade }}</td>
                <td>R$ {{ "%.2f"|format(venda.total_value) }}</td>
                <td>{{ venda.user if venda.user else 'N/A' }}</td>
                <td>
                    <form action="{{ url_for('excluir_venda', id=venda.id) }}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center">Nenhuma venda encontrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>